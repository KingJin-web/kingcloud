<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KingDrive</title>
</head>
<script type='text/javascript' src='../res/jquery-3.5.1.js'></script>
<script type="text/javascript" src="Popup.js"></script>
<link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="../bootstrap/js/bootstrap.min.js"></script>
<script src="../res/axios.js"></script>
<script type="text/javascript" src="/res/vue.js"></script>
<script src="../res/layui/layui.all.js"></script>
<body onload="queryFile(' ')">

<div class="layui-layout layui-layout-admin" id="main">
    <div class="layui-header layui-bg-cyan" id="head">
        <div class="layui-logo layui-hide-xs layui-bg-blue">KingDrive</div>
        <!-- 头部区域（可配合layui 已有的水平导航） -->
        <ul class="layui-nav layui-layout-left layui-bg-cyan">
            <!-- 移动端显示 -->
            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm"
                lay-header-event="menuLeft">
                <i class="layui-icon layui-icon-spread-left"></i>
            </li>

            <li class="layui-nav-item layui-hide-xs"><a href="">全部文件</a></li>
            <li class="layui-nav-item layui-hide-xs"><a href="">我的分享</a></li>
            <li class="layui-nav-item layui-hide-xs"><a href="">回收站</a></li>

        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                <a href="javascript:;">
                    <img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg"
                         class="layui-nav-img">
                    {{user.name}}
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">个人中心</a></dd>
                    <dd><a href="">设置</a></dd>
                    <dd><a href="">····</a></dd>
                    <dd><a href="">退出登录</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
                <a href="javascript:;">
                    <i class="layui-icon layui-icon-more-vertical"></i>
                </a>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-bg-cyan">
        <div class="layui-side-scroll ">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree " lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="" href="index.html">全部文件</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">图片</a></dd>
                        <dd><a href="javascript:;">文档</a></dd>
                        <dd><a href="javascript:;">视频</a></dd>
                        <dd><a href="javascript:;">种子</a></dd>
                        <dd><a href="javascript:;">音乐</a></dd>
                        <dd><a href="javascript:;">其他</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">我的分享</a>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">回收站</a></li>

            </ul>
        </div>
    </div>

    <div id="bodyS" class="layui-body layui-bg-gray">
        <!-- 内容主体区域 -->

        <div style="padding: 15px;width: 100%">
            <div class="col-lg-6" style="width: 100%">
                <div class="input-group">
                    <input type="text" class="form-control"/>
                    <span class="input-group-btn">
						<button class="btn btn-default" type="button" onclick="queryFile(' ')">
							Go!
						</button>
					</span>
                </div><!-- /input-group -->
            </div><!-- /.col-lg-6 -->
        </div>
        <div style="padding: 15px;width: 100%" id="fileTable">

            <table id="singers" lay-filter="demo" style="height: 52%">
                <thead>
                <tr>

                    <th lay-data="{field:'username', width:300}">文件名</th>

                    <th lay-data="{field:'experience', width:80, sort:true}">大小</th>
                    <th lay-data="{field:'sign' , sort:true}">修改日期</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div class="layui-footer">
            <!-- 底部固定区域 -->
            底部固定区域
        </div>
    </div>
</div>
<script type="text/javascript">

    function queryFile(path) {
        let files = [];

        axios.post('/getFile?path=' + path).then(res => {
            if (res.data.code === 1) {
                files = res.data.obj;
                console.log(files)
                var $table = $("#singers");
                //文件大小
                var filesize = "";
                var isDir = "";
                //添加成员（members）、生日（birthday）字段和头像（head）字段的展示
                for (const i of files) {
                    console.log(i.path)

                    if (i.isDirectory === true) {
                        filesize = " ";
                        isDir = "<img style='height: 20px;width: 20px'  src='../res/svg/文件夹.png'>"
                    } else {
                        filesize = i.fileSize + " kb";
                        isDir = "<img style='height: 20px;width: 20px' src='../res/svg/文件.png' alt=''>"
                    }
                    $table.append("<tr>" +
                        "<td>" + isDir + "&nbsp;&nbsp;&nbsp;&nbsp;" + i.name + "</td>" +
                        "<td>" + filesize + "</td>" +
                        "<td>" + i.modification_time + "</td>" +
                        "</tr>");

                    var table = layui.table;

                    //转换静态表格
                    table.init('demo', {
                        height: 600 //设置高度
                        , limit: 10 //注意：请务必确保 limit 参数（默认：10）是与你服务端限定的数据条数一致
                        , page: true //开启分页
                        //支持所有基础参数
                    });
                }
            }
        });


    }

    // const Table = new Vue({
    //     el: '#fileTable',
    //     data: {
    //         files: [],
    //         path: ''
    //     },
    //     mounted: function () {
    //
    //         var that =this;
    //         axios.post('/getFile?path=' + this.path).then(res => {
    //             if (res.data.code === 1) {
    //                 that.files = res.data.obj;
    //                 console.log(this.files)
    //             }
    //         });
    //         var table = layui.table;
    //
    //         //转换静态表格
    //         table.init('demo', {
    //             height: 315 //设置高度
    //             , limit: 10 //注意：请务必确保 limit 参数（默认：10）是与你服务端限定的数据条数一致
    //             //支持所有基础参数
    //         });
    //     }
    // });
</script>
<script type="text/javascript">
    const king = new Vue({
        el: '#main',
        data: {
            user: {}, //用户信息
            // files: [],
            // path: ""
        },
        mounted: function () {
            axios.post('/getUser').then(res => {
                if (res.data.code === 0) {
                    gotoLogin(res.data.msg, "/index.html");
                } else {
                    this.user = res.data.obj;
                }
            });
            // axios.post('/getFile?path=' + this.path).then(res => {
            //     if (res.data.code === 1) {
            //         console.log( res.data.obj);
            //         this.files = res.data.obj;
            //         console.log( this.files);
            //     }
            // });
            // tables.getFiles();
            //  console.log(tables.files)
        }
    });

</script>


<!--表格渲染-->


<script>
    //JS

    layui.use(['element', 'layer', 'util'], function () {
        var element = layui.element
            , layer = layui.layer
            , util = layui.util
            , $ = layui.$;

        //头部事件
        util.event('lay-header-event', {
            //左侧菜单事件
            menuLeft: function (othis) {
                layer.msg('展开左侧菜单的操作', {icon: 0});
            }
            , menuRight: function () {
                layer.open({
                    type: 1
                    , content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
                    , area: ['260px', '100%']
                    , offset: 'rt' //右上角
                    , anim: 5
                    , shadeClose: true
                });
            }
        });

    });
</script>
</body>
</html>